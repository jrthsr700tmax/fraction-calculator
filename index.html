<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>分數計算機</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        :root {
            --bg-gradient-start: #f5f7fa;
            --bg-gradient-end: #c3cfe2;
            --container-bg: rgba(255, 255, 255, 0.1);
            --container-border: rgba(255, 255, 255, 0.2);
            --input-bg: rgba(255, 255, 255, 0.2);
            --fraction-bg: rgba(255, 255, 255, 0.15);
            --text-primary: #1a1a1a;
            --text-secondary: #4a4a4a;
            --text-error: #FF3B30;
            --text-sum: #007AFF;
            --icon-fill: #333;
            --details-bg: rgba(255, 255, 255, 0.15);
            --details-hover: rgba(0, 122, 255, 0.1);
            --add-button-bg: rgba(52, 199, 89, 0.2);
            --add-button-hover: rgba(52, 199, 89, 0.4);
            --calc-button-bg: rgba(0, 122, 255, 0.2);
            --calc-button-hover: rgba(0, 122, 255, 0.4);
            --clear-button-bg: rgba(255, 149, 0, 0.2);
            --clear-button-hover: rgba(255, 149, 0, 0.4);
            --delete-button-bg: rgba(255, 59, 48, 0.2);
            --delete-button-hover: rgba(255, 59, 48, 0.4);
            --icon-fill-dark: #333;
            --icon-fill-light: #ffffff;
            --text-dark: #333;
            --text-light: #ffffff;
        }

        [data-theme="dark"] {
            --bg-gradient-start: #1c2526;
            --bg-gradient-end: #3a4f50;
            --container-bg: rgba(0, 0, 0, 0.3);
            --container-border: rgba(255, 255, 255, 0.1);
            --input-bg: rgba(255, 255, 255, 0.1);
            --fraction-bg: rgba(255, 255, 255, 0.08);
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --text-error: #ff6b6b;
            --text-sum: #4dabf7;
            --icon-fill: #ffffff;
            --details-bg: rgba(255, 255, 255, 0.08);
            --details-hover: rgba(0, 122, 255, 0.2);
            --add-button-bg: rgba(52, 199, 89, 0.3);
            --add-button-hover: rgba(52, 199, 89, 0.5);
            --calc-button-bg: rgba(0, 122, 255, 0.3);
            --calc-button-hover: rgba(0, 122, 255, 0.5);
            --clear-button-bg: rgba(255, 149, 0, 0.3);
            --clear-button-hover: rgba(255, 149, 0, 0.5);
            --delete-button-bg: rgba(255, 59, 48, 0.3);
            --delete-button-hover: rgba(255, 59, 48, 0.5);
            --icon-fill-dark: #333;
            --icon-fill-light: #ffffff;
            --text-dark: #333;
            --text-light: #ffffff;
        }

        body {
            font-family: -apple-system, SF Pro, Hiragino Sans, PingFang TC, Segoe UI, system-ui !important;
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 1rem;
            overflow-y: auto;
            color: var(--text-primary);
        }
        .header {
            position: relative;
            width: 100%;
            max-width: 66.67%;
            margin: 0 auto;
            margin-bottom: 1rem;
            text-align: center;
        }
        .container {
            background: var(--container-bg);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 66.67%;
            margin: 0 auto;
            border: 1px solid var(--container-border);
        }
        .fraction-input {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            background: var(--fraction-bg);
            padding: 0.75rem;
            border-radius: 12px;
            transition: transform 0.3s ease;
            position: relative;
        }
        .fraction-input:hover {
            transform: translateY(-2px);
        }
        .fraction-input label {
            color: var(--text-primary);
            display: flex;
            align-items: center;
        }
        .label-divider {
            display: inline-block;
            width: 0;
            border-left: 1px solid var(--text-primary);
            height: 1.2rem;
            margin: 0 0.5rem;
            vertical-align: middle;
        }
        input[type="number"] {
            flex: 1;
            min-width: 120px;
            max-width: 255px;
            background: var(--input-bg);
            border: none;
            border-radius: 8px;
            padding: 0.5rem;
            color: var(--text-primary);
            font-size: 1rem;
            text-align: center;
            transition: all 0.3s ease;
        }
        input[type="number"]:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(0, 122, 255, 0.5);
        }
        .slash {
            width: 1rem;
            text-align: center;
            color: var(--text-primary);
            font-size: 1rem;
        }
        .error {
            border: 2px solid var(--text-error);
        }
        .error-message {
            color: var(--text-error);
            font-size: 0.75rem;
            position: absolute;
            bottom: -1.25rem;
            left: 0.75rem;
            width: 100%;
        }
        .button-container {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            margin-top: 1rem;
            gap: 0.5rem;
        }
        .flex-grow {
            flex-grow: 1;
        }
        .adjacent-buttons {
            display: flex;
            gap: 0.25rem;
        }
        .icon-button {
            border-radius: 12px;
            padding: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
            color: var(--text-primary);
            font-weight: 500;
            width: 120px;
        }
        .icon-button svg {
            width: 20px;
            height: 20px;
            fill: var(--icon-fill);
        }
        #add-fraction {
            background: var(--add-button-bg);
        }
        #add-fraction:hover {
            background: var(--add-button-hover);
            transform: scale(1.05);
        }
        #calculate {
            background: var(--calc-button-bg);
        }
        #calculate:hover {
            background: var(--calc-button-hover);
            transform: scale(1.05);
        }
        #clear-all {
            background: var(--clear-button-bg);
        }
        #clear-all:hover {
            background: var(--clear-button-hover);
            transform: scale(1.05);
        }
        .delete-button {
            background: var(--delete-button-bg);
            border-radius: 8px;
            padding: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: auto;
        }
        .delete-button:hover {
            background: var(--delete-button-hover);
            transform: scale(1.05);
        }
        .delete-button svg {
            width: 18px;
            height: 18px;
            fill: var(--icon-fill);
        }
        #result {
            margin-top: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .sum-section, .details-section, .info-section {
            padding: 1rem;
            background: var(--fraction-bg);
            border-radius: 12px;
            color: var(--text-primary);
            border: 1px solid var(--container-border);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }
        .sum-result {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-sum);
            text-align: center;
            margin: 1rem 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .realtime-sum-result {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-align: center;
            margin: 1rem 0;
        }
        .non-simplified-sum {
            font-size: 1rem;
            color: var(--text-secondary);
            text-align: center;
            margin-top: 0.5rem;
        }
        .sum-result .whole-number {
            background-color: rgba(0, 122, 255, 0.16);
            color: var(--text-sum);
            border-radius: 4px;
            padding: 0.1rem 0.3rem;
            margin-right: 0.3rem;
            display: inline-block;
        }
        .realtime-sum-result .whole-number {
            background-color: rgba(74, 74, 74, 0.16);
            color: var(--text-secondary);
            border-radius: 4px;
            padding: 0.1rem 0.3rem;
            margin-right: 0.3rem;
            display: inline-block;
        }
        .non-simplified-sum .whole-number {
            background-color: rgba(74, 74, 74, 0.16);
            color: var(--text-secondary);
            border-radius: 4px;
            padding: 0.1rem 0.3rem;
            margin-right: 0.3rem;
            display: inline-block;
        }
        .info-section .whole-number {
            background-color: rgba(26, 26, 26, 0.16);
            color: var(--text-primary);
            border-radius: 4px;
            padding: 0.1rem 0.3rem;
            margin-right: 0.3rem;
            display: inline-block;
        }
        [data-theme="dark"] .sum-result .whole-number {
            background-color: rgba(77, 171, 247, 0.16);
            color: var(--text-sum);
        }
        [data-theme="dark"] .realtime-sum-result .whole-number {
            background-color: rgba(176, 176, 176, 0.16);
            color: var(--text-secondary);
        }
        [data-theme="dark"] .non-simplified-sum .whole-number {
            background-color: rgba(176, 176, 176, 0.16);
            color: var(--text-secondary);
        }
        [data-theme="dark"] .info-section .whole-number {
            background-color: rgba(255, 255, 255, 0.16);
            color: var(--text-primary);
        }
        .fraction-numerator, .fraction-denominator {
            padding: 0 0.2rem;
        }
        h1 {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }
        p {
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }
        details {
            background: var(--details-bg);
            border-radius: 12px;
            margin-bottom: 1rem;
            border: 1px solid var(--container-border);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }
        details > hr {
            border-top: 1px solid var(--container-border);
            margin: 0.5rem 0;
        }
        details > ul {
            padding: 1rem;
        }
        .info-section ul li,
        .details-section ul li {
            margin-bottom: 0.75rem;
        }
        .info-section ul li:last-child,
        .details-section ul li:last-child {
            margin-bottom: 0;
        }
        summary {
            padding: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.3s ease;
            color: var(--text-primary);
            border-radius: 12px;
            overflow: hidden;
        }
        summary:hover {
            background: var(--details-hover);
        }
        .theme-toggle-container {
            position: absolute;
            top: 0;
            right: 0;
        }
        .theme-toggle {
            background: var(--fraction-bg);
            border-radius: 12px;
            padding: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            color: var(--text-dark);
            min-width: 5rem;
            white-space: nowrap;
        }
        .theme-toggle svg {
            width: 20px;
            height: 20px;
            fill: var(--icon-fill-dark);
        }
        [data-theme="dark"] .theme-toggle {
            color: var(--text-light);
        }
        [data-theme="dark"] .theme-toggle svg {
            fill: var(--icon-fill-light);
        }
        .theme-menu {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--fraction-bg);
            backdrop-filter: blur(10px);
            border-radius: 8px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
            z-index: 10;
            min-width: 180px;
        }
        .theme-menu.show {
            display: block;
        }
        .theme-menu button {
            display: flex;
            align-items: center;
            width: 100%;
            padding: 0.5rem 1rem;
            background: none;
            border: none;
            color: var(--text-dark);
            text-align: left;
            cursor: pointer;
            transition: background 0.3s ease;
            gap: 0.5rem;
        }
        [data-theme="dark"] .theme-menu button {
            color: var(--text-light);
        }
        .theme-menu button svg {
            width: 16px;
            height: 16px;
            fill: var(--icon-fill-dark);
        }
        [data-theme="dark"] .theme-menu button svg {
            fill: var(--icon-fill-light);
        }
        .theme-menu button:hover {
            background: var(--details-hover);
        }

        /* Responsive Design */
        @media (max-width: 640px) {
            body {
                padding: 0.5rem;
            }
            .header {
                max-width: 100%;
            }
            .container {
                padding: 1rem;
                max-width: 100%;
            }
            .fraction-input {
                display: flex;
                flex-direction: row;
                align-items: center;
                gap: 0.5rem;
                padding: 0.5rem;
            }
            h1 {
                font-size: 1.5rem;
            }
            p {
                font-size: 0.9rem;
            }
            .fraction-input label {
                font-size: 0.9rem;
                order: 1;
            }
            .label-divider {
                height: 1rem;
                margin: 0 0.4rem;
            }
            input[type="number"] {
                flex: 1;
                min-width: 70px;
                max-width: 100px;
                font-size: 0.9rem;
            }
            .fraction-input .numerator {
                order: 2;
            }
            .fraction-input .slash {
                order: 3;
                width: 0.9rem;
                font-size: 0.9rem;
            }
            .fraction-input .denominator {
                order: 4;
            }
            .fraction-input .delete-button {
                order: 5;
                margin-top: 0;
                padding: 0.3rem;
                width: auto;
                display: flex;
                margin-left: auto;
            }
            .delete-button svg {
                width: 14px;
                height: 14px;
            }
            .error-message {
                font-size: 0.7rem;
                position: absolute;
                bottom: -1rem;
                left: 0.5rem;
                width: 100%;
            }
            .button-container {
                display: flex;
                flex-direction: row;
                align-items: center;
                gap: 0.5rem;
            }
            .adjacent-buttons {
                display: flex;
                flex-direction: row;
                gap: 0.25rem;
            }
            .flex-grow {
                display: block;
                flex-grow: 1;
            }
            .icon-button {
                width: 100px;
                padding: 0.5rem;
                font-size: 0.9rem;
            }
            .icon-button svg {
                width: 18px;
                height: 18px;
            }
            .sum-result {
                font-size: 1.5rem;
            }
            .realtime-sum-result {
                font-size: 1.2rem;
            }
            .non-simplified-sum {
                font-size: 0.9rem;
            }
            .sum-result .whole-number,
            .realtime-sum-result .whole-number,
            .non-simplified-sum .whole-number,
            .info-section .whole-number {
                padding: 0.1rem 0.2rem;
                margin-right: 0.2rem;
            }
            .fraction-numerator, .fraction-denominator {
                padding: 0 0.15rem;
            }
            .sum-section, .details-section, .info-section {
                padding: 0.75rem;
            }
            details > ul, .info-section ul {
                padding: 0.75rem;
            }
            .info-section ul li,
            .details-section ul li {
                margin-bottom: 0.5rem;
            }
            .info-section ul li:last-child,
            .details-section ul li:last-child {
                margin-bottom: 0;
            }
            details > hr {
                margin: 0.4rem 0;
            }
            .theme-toggle {
                padding: 0.4rem;
                min-width: 4.5rem;
            }
            .theme-toggle svg {
                width: 18px;
                height: 18px;
            }
            .theme-menu {
                min-width: 160px;
            }
            .theme-menu button {
                font-size: 0.9rem;
                padding: 0.4rem 0.8rem;
            }
            .theme-menu button svg {
                width: 14px;
                height: 14px;
            }
        }

        @media (max-width: 480px) {
            #add-fraction span {
                display: none;
            }
            #add-fraction {
                width: 40px;
                padding: 0.5rem;
            }
            #add-fraction svg {
                width: 20px;
                height: 20px;
            }
            .icon-button:not(#add-fraction) {
                width: 80px;
                font-size: 0.8rem;
            }
            .adjacent-buttons {
                gap: 0.2rem;
            }
        }

        @media (min-width: 641px) and (max-width: 1024px) {
            .container {
                padding: 1.5rem;
                max-width: 66.67%;
            }
            h1 {
                font-size: 1.6rem;
            }
            p {
                font-size: 1rem;
            }
            input[type="number"] {
                flex: 1;
                min-width: 120px;
                max-width: 200px;
            }
            .slash {
                width: 1rem;
            }
            .fraction-input {
                gap: 0.75rem;
            }
            .sum-result {
                font-size: 1.8rem;
            }
            .realtime-sum-result {
                font-size: 1.4rem;
            }
            .non-simplified-sum {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="theme-toggle-container">
            <button class="theme-toggle" id="theme-toggle" title="切換主題">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M12 3a9 9 0 109 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 01-4.4 2.26 5.403 5.403 0 01-3.14-9.8c-.44-.06-.90-.1-1.36-.1z"/>
                </svg>
                主題
            </button>
            <div class="theme-menu" id="theme-menu">
                <button data-theme="light">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.57a1 1 0 00-1.42 0L3.51 5.64a1 1 0 000 1.42c.39.39 1.02.39 1.41 0l1.06-1.06c.39-.39.39-1.03 0-1.43zm12.92 12.86l1.06 1.06c.39.39 1.03.39 1.42 0 .39-.39.39-1.02 0-1.41l-1.06-1.06a1 1 0 00-1.42 0c-.39.39-.39 1.02 0 1.41zM5.64 18.36l-1.06 1.06c-.39.39-.39 1.03 0 1.42.39.39 1.02.39 1.41 0l1.06-1.06a1 1 0 000-1.42c-.39-.39-1.03-.39-1.41 0zm12.86-12.92l1.06-1.06c.39-.39.39-1.03 0-1.42-.39-.39-1.02-.39-1.41 0l-1.06 1.06a1 1 0 000 1.42c.39.39 1.03.39 1.41 0z"/>
                    </svg>
                    淺色
                </button>
                <button data-theme="dark">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M12 3a9 9 0 109 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 01-4.4 2.26 5.403 5.403 0 01-3.14-9.8c-.44-.06-.90-.1-1.36-.1z"/>
                    </svg>
                    深色
                </button>
                <button data-theme="system">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.06-.94l2.03-1.58a.49.49 0 00.12-.61l-1.92-3.32a.488.488 0 00-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54a.484.484 0 00-.48-.41h-3.84c-.24 0-.43.17-.47-.41l-.36 2.54c-.59.24-1.13.56-1.62.94l-2.39-.96c-.22-.09-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.3-.06.62-.06.94s.02.64.06.94l-2.03 1.58a.49.49 0 00-.12.61l1.92 3.32c.12.22.37.31.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .43-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.09.47 0 .59-.22l1.92-3.32c.12-.22.08-.47-.12-.61l-2.03-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
                    </svg>
                    根據系統設定
                </button>
            </div>
        </div>
        <h1>分數計算機</h1>
        <p>在下方輸入分數，並依照自己喜好新增或刪除。網站將會根據輸入的分數來加總並即時顯示結果，同時計算約分與通分的結果。</p>
    </div>
    <div class="container">
        <div id="fractions-container">
            <div class="fraction-input">
                <label>分數 1<span class="label-divider"></span></label>
                <input type="number" class="numerator" placeholder="分子" required>
                <span class="slash">/</span>
                <input type="number" class="denominator" placeholder="分母" required min="1">
                <button class="delete-button" title="刪除分數">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                    </svg>
                </button>
                <div class="error-message"></div>
            </div>
            <div class="fraction-input">
                <label>分數 2<span class="label-divider"></span></label>
                <input type="number" class="numerator" placeholder="分子" required>
                <span class="slash">/</span>
                <input type="number" class="denominator" placeholder="分母" required min="1">
                <button class="delete-button" title="刪除分數">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                    </svg>
                </button>
                <div class="error-message"></div>
            </div>
        </div>
        
        <div class="button-container">
            <button id="add-fraction" class="icon-button">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"/>
                </svg>
                <span>新增分數</span>
            </button>
            <div class="flex-grow"></div>
            <div class="adjacent-buttons">
                <button id="calculate" class="icon-button">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14h-2v-2h2v2zm0-4h-2v-2h2v2zm-4 4H8v-2h2v2zm0-4H8v-2h2v2zm8 0h-2v-2h2v2zm0-4h-2V7h2v2z"/>
                    </svg>
                    計算
                </button>
                <button id="clear-all" class="icon-button">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M18.3 5.71a.996.996 0 00-1.41 0L12 10.59 7.11 5.7a.996.996 0 00-1.41 0c-.39.39-.39 1.02 0 1.41L10.59 12 5.7 16.89a.996.996 0 000 1.41c.39.39 1.02.39 1.41 0L12 13.41l4.89 4.89c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4z"/>
                    </svg>
                    清除
                </button>
            </div>
        </div>
        
        <div id="result">
            <div class="sum-section">
                <h2 class="text-lg font-semibold mb-2">加總結果</h2>
                <div class="realtime-sum-result">輸入兩組有效的分數來進行計算</div>
            </div>
            <div class="info-section">
                <h2 class="text-lg font-semibold mb-2">說明</h2>
                <ul class="list-disc pl-5">
                    <li>在輸入區域輸入分數來進行計算。分子需為非負數且小於或等於分母；分母需大於 0（例如：1/2、1/1）。</li>
                    <li>點按綠色「新增分數」按鈕來新增分數；當輸入的分數超過 2 個時，則可點按右側紅色垃圾桶圖示來刪除不想要的分數。</li>
                    <li>輸入或修改分數時，網站會即時計算並在「加總結果」顯示簡化後的分數。當計算結果的分數帶有整數時，其整數會帶有刷淡圓角矩形以利辨識，如「<b><span class="whole-number">1</span><span class="fraction-numerator">4</span>/<span class="fraction-denominator">15</span></b>」；當計算結果不帶整數時，則會顯示「<b><span class="fraction-numerator">1</span>/<span class="fraction-denominator">1</span></b>」。</li>
                    <li>點按藍色「計算」按鈕來確認最終結果，將會顯示最約分與最通分（如有）的加總結果，並可在「詳細計算」中查看約分與通分後的各個分數。</li>
                    <li>點按橘色「清除」按鈕，清空所有已輸入的分數並重置計算結果。</li>
                    <li>點按右上角「主題」按鈕可以根據自己的喜好來切換淺色、深色或系統主題模式。</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // 主題切換邏輯
        function setTheme(theme) {
            if (theme === 'system') {
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    document.documentElement.setAttribute('data-theme', 'dark');
                } else {
                    document.documentElement.setAttribute('data-theme', 'light');
                }
            } else {
                document.documentElement.setAttribute('data-theme', theme);
            }
            localStorage.setItem('theme', theme);
        }

        // 初始化主題
        const savedTheme = localStorage.getItem('theme') || 'system';
        setTheme(savedTheme);

        // 監聽系統主題變化
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
            if (localStorage.getItem('theme') === 'system') {
                setTheme('system');
            }
        });

        // 主題切換下拉選單
        const themeToggle = document.getElementById('theme-toggle');
        const themeMenu = document.getElementById('theme-menu');
        themeToggle.addEventListener('click', () => {
            themeMenu.classList.toggle('show');
        });

        // 點擊選單外關閉
        document.addEventListener('click', (e) => {
            if (!themeToggle.contains(e.target) && !themeMenu.contains(e.target)) {
                themeMenu.classList.remove('show');
            }
        });

        // 主題選項點擊事件
        themeMenu.querySelectorAll('button').forEach(button => {
            button.addEventListener('click', () => {
                setTheme(button.getAttribute('data-theme'));
                themeMenu.classList.remove('show');
            });
        });

        // 計算最大公因數 (GCD)
        function gcd(a, b) {
            a = Math.abs(a);
            b = Math.abs(b);
            while (b !== 0) {
                let temp = b;
                b = a % b;
                a = temp;
            }
            return a;
        }

        // 計算最小公倍數 (LCM)
        function lcm(a, b) {
            return Math.abs(a * b) / gcd(a, b);
        }

        // 計算多個數的最小公倍數
        function lcmMultiple(nums) {
            let result = nums[0];
            for (let i = 1; i < nums.length; i++) {
                result = lcm(result, nums[i]);
            }
            return result;
        }

        // 約分一個分數
        function simplifyFraction(num, den) {
            const g = gcd(num, den);
            return { num: num / g, den: den / g };
        }

        // 格式化分數（確保分子等於分母時顯示，例如 1/1, 15/15；大於 1 時顯示整數+分數）
        function formatFraction(num, den) {
            if (num === den && num !== 0) {
                return `<span class="fraction-numerator">${num}</span>/<span class="fraction-denominator">${den}</span>`;
            }
            if (num > den) {
                const whole = Math.floor(num / den);
                const remainder = num % den;
                if (remainder === 0) {
                    return `<span class="whole-number">${whole}</span>`;
                }
                return `<span class="whole-number">${whole}</span><span class="fraction-numerator">${remainder}</span>/<span class="fraction-denominator">${den}</span>`;
            }
            return `<span class="fraction-numerator">${num}</span>/<span class="fraction-denominator">${den}</span>`;
        }

        // 分數加總
        function addFractions(fractions) {
            const commonDen = lcmMultiple(fractions.map(f => f.den));
            const sumNum = fractions.reduce((sum, f) => {
                const multiplier = commonDen / f.den;
                return sum + f.num * multiplier;
            }, 0);
            return { simplified: simplifyFraction(sumNum, commonDen), nonSimplified: { num: sumNum, den: commonDen } };
        }

        // 驗證單個分數輸入
        function validateFraction(inputDiv, index) {
            const numInput = inputDiv.querySelector('.numerator');
            const denInput = inputDiv.querySelector('.denominator');
            const errorMessageDiv = inputDiv.querySelector('.error-message');
            numInput.classList.remove('error');
            denInput.classList.remove('error');
            errorMessageDiv.textContent = '';

            const num = parseInt(numInput.value);
            const den = parseInt(denInput.value);

            if (isNaN(num) || isNaN(den)) {
                return false; // Incomplete, no error styling
            }
            if (den <= 0) {
                denInput.classList.add('error');
                errorMessageDiv.textContent = `分數 ${index + 1}: 分母必須大於 0`;
                return false;
            }
            if (num < 0) {
                numInput.classList.add('error');
                errorMessageDiv.textContent = `分數 ${index + 1}: 分子必須為非負數`;
                return false;
            }
            if (num > den) {
                numInput.classList.add('error');
                errorMessageDiv.textContent = `分數 ${index + 1}: 分子 (${num}) 必須小於或等於分母 (${den})`;
                return false;
            }
            return true;
        }

        // 驗證所有分數並可選返回有效分數
        function validateAllFractions(returnValidFractions = false) {
            const inputs = document.querySelectorAll('.fraction-input');
            let allValid = true;
            const validFractions = [];
            inputs.forEach((inputDiv, index) => {
                const numInput = inputDiv.querySelector('.numerator');
                const denInput = inputDiv.querySelector('.denominator');
                const num = parseInt(numInput.value);
                const den = parseInt(denInput.value);
                if (isNaN(num) || isNaN(den)) {
                    if (returnValidFractions) return;
                    validateFraction(inputDiv, index);
                    allValid = false;
                    return;
                }
                if (validateFraction(inputDiv, index)) {
                    validFractions.push({ num, den });
                } else {
                    allValid = false;
                }
            });
            return returnValidFractions ? { valid: allValid, fractions: validFractions } : allValid;
        }

        // 即時計算結果
        function calculateRealtime() {
            const { fractions: validFractions } = validateAllFractions(true);
            let resultHTML = `
                <div class="sum-section">
                    <h2 class="text-lg font-semibold mb-2">加總結果</h2>
            `;
            if (validFractions.length < 2) {
                resultHTML += `<div class="realtime-sum-result">輸入兩組有效的分數來進行計算</div>`;
            } else {
                const { simplified: sumFraction } = addFractions(validFractions);
                resultHTML += `<div class="realtime-sum-result">${formatFraction(sumFraction.num, sumFraction.den)}</div>`;
            }
            resultHTML += `</div>
                <div class="info-section">
                    <h2 class="text-lg font-semibold mb-2">說明</h2>
                    <ul class="list-disc pl-5">
                        <li>在輸入區域輸入分數來進行計算。分子需為非負數且小於或等於分母；分母需大於 0（例如：1/2、1/1）。</li>
                        <li>點按綠色「新增分數」按鈕來新增分數；當輸入的分數超過 2 個時，則可點按右側紅色垃圾桶圖示來刪除不想要的分數。</li>
                        <li>輸入或修改分數時，網站會即時計算並在「加總結果」顯示簡化後的分數。當計算結果的分數帶有整數時，其整數會帶有刷淡圓角矩形以利辨識，如「<b><span class="whole-number">1</span><span class="fraction-numerator">4</span>/<span class="fraction-denominator">15</span></b>」；當計算結果不帶整數時，則會顯示「<b><span class="fraction-numerator">1</span>/<span class="fraction-denominator">1</span></b>」。</li>
                        <li>點按藍色「計算」按鈕來確認最終結果，將會顯示最約分與最通分（如有）的加總結果，並可在「詳細計算」中查看約分與通分後的各個分數。</li>
                        <li>點按橘色「清除」按鈕，清空所有已輸入的分數並重置計算結果。</li>
                        <li>點按右上角「主題」按鈕可以根據自己的喜好來切換淺色、深色或系統主題模式。</li>
                    </ul>
                </div>`;
            document.getElementById('result').innerHTML = resultHTML;
        }

        // 為每個輸入框添加即時驗證和計算
        function setupInputValidation() {
            document.getElementById('fractions-container').addEventListener('input', function(e) {
                if (e.target.classList.contains('numerator') || e.target.classList.contains('denominator')) {
                    const inputDiv = e.target.closest('.fraction-input');
                    const index = Array.from(document.querySelectorAll('.fraction-input')).indexOf(inputDiv);
                    validateFraction(inputDiv, index);
                    calculateRealtime();
                }
            });
        }

        // 添加更多分數輸入
        document.getElementById('add-fraction').addEventListener('click', function() {
            const container = document.getElementById('fractions-container');
            const count = container.children.length + 1;
            const div = document.createElement('div');
            div.className = 'fraction-input';
            div.innerHTML = `
                <label>分數 ${count}<span class="label-divider"></span></label>
                <input type="number" class="numerator" placeholder="分子" required>
                <span class="slash">/</span>
                <input type="number" class="denominator" placeholder="分母" required min="1">
                <button class="delete-button" title="刪除分數">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                    </svg>
                </button>
                <div class="error-message"></div>
            `;
            container.appendChild(div);
            updateDeleteButtonVisibility();
            setupInputValidation();
            calculateRealtime();
        });

        // 刪除分數輸入
        document.getElementById('fractions-container').addEventListener('click', function(e) {
            if (e.target.closest('.delete-button')) {
                const container = document.getElementById('fractions-container');
                if (container.children.length > 2) {
                    e.target.closest('.fraction-input').remove();
                    Array.from(container.children).forEach((div, index) => {
                        div.querySelector('label').innerHTML = `分數 ${index + 1}<span class="label-divider"></span>`;
                    });
                    updateDeleteButtonVisibility();
                    calculateRealtime();
                } else {
                    alert('至少需要保留兩個分數！');
                    calculateRealtime();
                }
            }
        });

        // 清除所有輸入
        document.getElementById('clear-all').addEventListener('click', function() {
            const inputs = document.querySelectorAll('.numerator, .denominator');
            inputs.forEach(input => {
                input.value = '';
                input.classList.remove('error');
            });
            const errorMessages = document.querySelectorAll('.error-message');
            errorMessages.forEach(msg => msg.textContent = '');
            calculateRealtime();
        });

        // 更新刪除按鈕的可見性
        function updateDeleteButtonVisibility() {
            const container = document.getElementById('fractions-container');
            const deleteButtons = container.querySelectorAll('.delete-button');
            if (container.children.length <= 2) {
                deleteButtons.forEach(btn => btn.style.display = 'none');
            } else {
                deleteButtons.forEach(btn => btn.style.display = 'flex');
            }
        }

        // 初始化刪除按鈕可見性和輸入驗證
        updateDeleteButtonVisibility();
        setupInputValidation();

        // 計算按鈕事件（確定結果）
        document.getElementById('calculate').addEventListener('click', function() {
            if (!validateAllFractions()) {
                return;
            }

            const { fractions } = validateAllFractions(true);
            const simplified = fractions.map(f => simplifyFraction(f.num, f.den));
            const commonDen = lcmMultiple(fractions.map(f => f.den));
            const commonFractions = fractions.map(f => {
                const multiplier = commonDen / f.den;
                return { num: f.num * multiplier, den: commonDen };
            });
            const { simplified: sumFraction, nonSimplified: nonSimplifiedSum } = addFractions(commonFractions);

            const isFullySimplified = gcd(sumFraction.num, sumFraction.den) === 1;
            const isSameDenominator = sumFraction.den === commonDen;
            const showNonSimplified = !(isFullySimplified && isSameDenominator);

            let resultHTML = `
                <div class="sum-section">
                    <h2 class="text-lg font-semibold mb-2">加總結果</h2>
                    <div class="sum-result">${formatFraction(sumFraction.num, sumFraction.den)}</div>
                    ${showNonSimplified ? `<div class="non-simplified-sum">未約分：${formatFraction(nonSimplifiedSum.num, nonSimplifiedSum.den)}</div>` : ''}
                </div>
                <div class="details-section">
                    <h2 class="text-lg font-semibold mb-2">詳細計算</h2>
                    <details>
                        <summary>約分後的分數</summary>
                        <hr>
                        <ul class="list-disc pl-5 mt-2">
            `;
            simplified.forEach((f, i) => {
                resultHTML += `<li>分數 ${i+1}: ${f.num}/${f.den}</li>`;
            });
            resultHTML += `</ul>
                    </details>
                    <details>
                        <summary>通分後的分數（共同分母：${commonDen}）</summary>
                        <hr>
                        <ul class="list-disc pl-5 mt-2">
            `;
            commonFractions.forEach((f, i) => {
                resultHTML += `<li>分數 ${i+1}: ${f.num}/${f.den}</li>`;
            });
            resultHTML += `</ul>
                    </details>
                </div>
                <div class="info-section">
                    <h2 class="text-lg font-semibold mb-2">說明</h2>
                    <ul class="list-disc pl-5">
                        <li>在輸入區域輸入分數來進行計算。分子需為非負數且小於或等於分母；分母需大於 0（例如：1/2、1/1）。</li>
                        <li>點按綠色「新增分數」按鈕來新增分數；當輸入的分數超過 2 個時，則可點按右側紅色垃圾桶圖示來刪除不想要的分數。</li>
                        <li>輸入或修改分數時，網站會即時計算並在「加總結果」顯示簡化後的分數。當計算結果的分數帶有整數時，其整數會帶有刷淡圓角矩形以利辨識，如「<b><span class="whole-number">1</span><span class="fraction-numerator">4</span>/<span class="fraction-denominator">15</span></b>」；當計算結果不帶整數時，則會顯示「<b><span class="fraction-numerator">1</span>/<span class="fraction-denominator">1</span></b>」。</li>
                        <li>點按藍色「計算」按鈕來確認最終結果，將會顯示最約分與最通分（如有）的加總結果，並可在「詳細計算」中查看約分與通分後的各個分數。</li>
                        <li>點按橘色「清除」按鈕，清空所有已輸入的分數並重置計算結果。</li>
                        <li>點按右上角「主題」按鈕可以根據自己的喜好來切換淺色、深色或系統主題模式。</li>
                    </ul>
                </div>`;

            document.getElementById('result').innerHTML = resultHTML;
        });
    </script>
</body>
</html>
